<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:ScreenshotAnnotator.ViewModels"
             xmlns:controls="using:ScreenshotAnnotator.Controls"
			 xmlns:views="using:ScreenshotAnnotator.Views"
			 xmlns:converters="using:ScreenshotAnnotator.Converters"
			 xmlns:local="using:ScreenshotAnnotator.Markup"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="ScreenshotAnnotator.Views.ImageEditorView"
             x:DataType="vm:ImageEditorViewModel">

  <UserControl.Resources>
    <converters:BoolToChevronPathConverter x:Key="BoolToChevronPathConverter"/>
  </UserControl.Resources>

  <Design.DataContext>
    <vm:ImageEditorViewModel />
  </Design.DataContext>

  <DockPanel>
	  <DockPanel DockPanel.Dock="Top">
		  <!-- Menu Bar -->
		  <Menu DockPanel.Dock="Left">
			  <MenuItem x:Name="AboutMenuItem"
	              Header="{Binding HeaderInformation}">
				  <MenuItem.Icon>
					  <Image Source="../Assets/App.png" />
				  </MenuItem.Icon>
				  <MenuItem.Items>
					  <MenuItem Header="{local:Localize Menu_WebSite}"
								Command="{Binding OpenWebsiteCommand}">
						  <MenuItem.Icon>
							  <Image Source="../Assets/App.png" />
						  </MenuItem.Icon>
					  </MenuItem>
					  <MenuItem Header="{local:Localize Menu_License}" Command="{Binding OpenLicenseCommand}" />
				  </MenuItem.Items>
			  </MenuItem>

			  <MenuItem Header="{local:Localize Menu_File}">
				  <MenuItem Header="{local:Localize Menu_New}" Command="{Binding NewProjectCommand}" InputGesture="Ctrl+N"/>
				  <MenuItem Header="{local:Localize Menu_Import}" Command="{Binding ImportCommand}" InputGesture="Ctrl+O"/>
				  <MenuItem Header="{local:Localize Menu_Export}" Command="{Binding ExportCommand}" InputGesture="Ctrl+S" />
				  <Separator/>
				  <MenuItem Header="{local:Localize Menu_OpenProjectsFolder}" Command="{Binding OpenProjectsFolderCommand}"/>
				  <MenuItem Header="{local:Localize Menu_OpenLogsFolder}" Command="{Binding OpenLogsFolderCommand}"/>
			  </MenuItem>
		  </Menu>

		  <!-- Current File Name Display -->
		  <Border DockPanel.Dock="Left"
		          Background="#2C2C2C"
		          CornerRadius="4"
		          Padding="12,4"
		          Margin="8,4,8,4"
		          VerticalAlignment="Center"
		          ToolTip.Tip="{Binding CurrentFilePathTooltip}"
				  IsVisible="{Binding !!CurrentFileName}">
			  <TextBlock Text="{Binding CurrentFileName}"
			             Foreground="#FFA500"
			             FontWeight="SemiBold"
			             FontSize="13"/>
		  </Border>
		  <Border DockPanel.Dock="Right">
			  <!-- Draggable area -->
		  </Border>
	  </DockPanel>
    

    <!-- Toolbar -->
    <Border DockPanel.Dock="Top"
            Background="#1C1C1C"
            BorderBrush="#CCCCCC"
            BorderThickness="0,0,0,1"
            Padding="8">
		<Border.Styles>
			<Style Selector="TextBlock">
				<Setter Property="Foreground" Value="#E6E6E6" />
				<Setter Property="FontSize" Value="12" />
				<Setter Property="HorizontalAlignment" Value="Center" />
			</Style>
			<Style Selector="Button">
				<Setter Property="Padding" Value="8" />
				<Setter Property="Background" Value="Transparent" />
			</Style>
			<Style Selector="ToggleButton">
				<Setter Property="Padding" Value="8" />
				<Setter Property="Background" Value="Transparent" />
			</Style>
			<Style Selector="Path">
				<Setter Property="Stretch" Value="Uniform" />
				<Setter Property="Width" Value="20" />
				<Setter Property="Height" Value="20" />
			</Style>
			<Style Selector="Ellipse">
				<Setter Property="Stretch" Value="Uniform" />
				<Setter Property="Width" Value="20" />
				<Setter Property="Height" Value="20" />
			</Style>
			<Style Selector="StackPanel">
				<Setter Property="Spacing" Value="8" />
			</Style>
		</Border.Styles>
      <StackPanel Orientation="Horizontal">

        <!-- New Project Button -->
        <Button Command="{Binding NewProjectCommand}"
                ToolTip.Tip="{local:Localize Tooltip_New}">
          <StackPanel HorizontalAlignment="Center">
            <Path Data="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"
                  Fill="#4CAF50" />
            <TextBlock Text="{local:Localize Tool_New}" />
          </StackPanel>
        </Button>

        <!-- Import Button -->
        <Button Command="{Binding ImportCommand}"
                ToolTip.Tip="{local:Localize Tooltip_Import}">
          <StackPanel HorizontalAlignment="Center">
            <Path Data="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"
                  Fill="#2196F3" />
            <TextBlock Text="{local:Localize Tool_Import}" />
          </StackPanel>
        </Button>

        <!-- Take Screenshot Button -->
        <Button Command="{Binding TakeScreenshotCommand}"
                ToolTip.Tip="{local:Localize Tooltip_Screenshot}">
          <StackPanel HorizontalAlignment="Center">
            <Ellipse Fill="#F44336"
                     Stroke="#C62828"
                     StrokeThickness="2"/>
            <TextBlock Text="{local:Localize Tool_Screenshot}" />
          </StackPanel>
        </Button>

        <!-- Separator -->
        <Border Width="1" Background="#CCCCCC" Margin="4,0"/>

		  <!-- Copy to Clipboard Button -->
		  <Button Command="{Binding CopyToClipboardCommand}"
				  ToolTip.Tip="{local:Localize Tooltip_Copy}">
			  <StackPanel HorizontalAlignment="Center">
				  <Path Data="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"
						Fill="#1976D2" />
				  <TextBlock Text="{local:Localize Tool_Copy}" />
			  </StackPanel>
		  </Button>

        <!-- Paste from Clipboard Button -->
        <Button Command="{Binding PasteFromClipboardCommand}"
                ToolTip.Tip="{local:Localize Tooltip_Paste}">
          <StackPanel HorizontalAlignment="Center">
            <Path Data="M19,20H5V4H7V7H17V4H19M12,2A1,1 0 0,1 13,3A1,1 0 0,1 12,4A1,1 0 0,1 11,3A1,1 0 0,1 12,2M19,2H14.82C14.4,0.84 13.3,0 12,0C10.7,0 9.6,0.84 9.18,2H5A2,2 0 0,0 3,4V20A2,2 0 0,0 5,22H19A2,2 0 0,0 21,20V4A2,2 0 0,0 19,2Z"
                  Fill="#1976D2" />
            <TextBlock Text="{local:Localize Tool_Paste}" />
          </StackPanel>
        </Button>

        <!-- Separator -->
        <Border Width="1" Background="#CCCCCC" Margin="4,0"/>

        <!-- Select/Move Tool Button -->
        <ToggleButton IsChecked="{Binding IsSelectToolSelected}"
                      Command="{Binding SelectSelectToolCommand}"
                      ToolTip.Tip="{local:Localize Tooltip_Select}">
          <StackPanel HorizontalAlignment="Center">
            <Path Data="M2,2 L2,18 L7,13 L10,20 L13,19 L10,12 L18,12 Z"
                  Fill="#D8DEE3" />
            <TextBlock Text="{local:Localize Tool_Select}" />
          </StackPanel>
        </ToggleButton>

		  <!-- Selector Tool Button -->
		  <ToggleButton IsChecked="{Binding IsSelectorToolSelected}"
						Command="{Binding SelectSelectorToolCommand}"
						ToolTip.Tip="{local:Localize Tooltip_Select}">
			  <StackPanel HorizontalAlignment="Center">
				  <Path Data="M2,2 L2,18 M2,2 L18,2 M18,2 L18,18 M2,18 L18,18"
						Stroke="#D8DEE3"
						StrokeThickness="2"
						StrokeDashArray="2,2" />
				  <TextBlock Text="{local:Localize Tool_Select}" />
			  </StackPanel>
		  </ToggleButton>

		  <!-- Arrow Tool Button -->
        <ToggleButton IsChecked="{Binding IsArrowToolSelected}"
                      Command="{Binding SelectArrowToolCommand}"
                      ToolTip.Tip="{local:Localize Tooltip_Arrow}">
          <StackPanel HorizontalAlignment="Center">
            <Path Data="M2,2 L18,10 L10,12 L8,20 Z M10,12 L18,18"
                  Stroke="#D8DEE3"
                  StrokeThickness="2"
                  Fill="Transparent" />
            <TextBlock Text="{local:Localize Tool_Arrow}" />
          </StackPanel>
        </ToggleButton>

        <!-- Callout Tool Button -->
        <ToggleButton IsChecked="{Binding IsCalloutToolSelected}"
                      Command="{Binding SelectCalloutToolCommand}"
                      ToolTip.Tip="{local:Localize Tooltip_Callout}">
          <StackPanel HorizontalAlignment="Center">
            <Path Data="M4,4 L16,4 L16,12 L10,12 L8,16 L8,12 L4,12 Z"
                  Stroke="#D8DEE3"
                  StrokeThickness="2"
                  Fill="Transparent" />
            <TextBlock Text="{local:Localize Tool_Callout}" />
          </StackPanel>
        </ToggleButton>

        <!-- Callout No Arrow Tool Button -->
        <ToggleButton IsChecked="{Binding IsCalloutNoArrowToolSelected}"
                      Command="{Binding SelectCalloutNoArrowToolCommand}"
                      ToolTip.Tip="{local:Localize Tooltip_Note}">
          <StackPanel HorizontalAlignment="Center">
            <Path Data="M4,4 L16,4 L16,12 L4,12 Z"
                  Stroke="#D8DEE3"
                  StrokeThickness="2"
                  Fill="Transparent" />
            <TextBlock Text="{local:Localize Tool_Note}" />
          </StackPanel>
        </ToggleButton>

        <!-- Bordered Rectangle Tool Button -->
        <ToggleButton IsChecked="{Binding IsBorderedRectangleToolSelected}"
                      Command="{Binding SelectBorderedRectangleToolCommand}"
                      ToolTip.Tip="{local:Localize Tooltip_Border}">
          <StackPanel HorizontalAlignment="Center">
            <Path Data="M2,2 L18,2 L18,18 L2,18 Z"
                  Stroke="#D8DEE3"
                  StrokeThickness="2"
                  Fill="Transparent" />
            <TextBlock Text="{local:Localize Tool_Border}" />
          </StackPanel>
        </ToggleButton>


		  <!-- Highlighter Tool Button -->
		  <ToggleButton IsChecked="{Binding IsHighlighterToolSelected}"
						Command="{Binding SelectHighlighterToolCommand}"
						ToolTip.Tip="{local:Localize Tooltip_Highlight}">
			  <StackPanel HorizontalAlignment="Center">
				  <Path Data="M2,2 L18,2 L18,18 L2,18 Z"
						Stroke="Transparent"
						StrokeThickness="0"
						Fill="#80FFFF00" />
				  <TextBlock Text="{local:Localize Tool_Highlight}" />
			  </StackPanel>
		  </ToggleButton>

        <!-- Blur Rectangle Tool Button -->
        <ToggleButton IsChecked="{Binding IsBlurRectangleToolSelected}"
                      Command="{Binding SelectBlurRectangleToolCommand}"
                      ToolTip.Tip="{local:Localize Tooltip_Blur}">
          <StackPanel HorizontalAlignment="Center">
            <Path Data="M2,2 L18,2 L18,18 L2,18 Z M5,5 L15,5 L15,15 L5,15 Z"
                  Stroke="#D8DEE3"
                  StrokeThickness="2"
                  Fill="#80808080" />
            <TextBlock Text="{local:Localize Tool_Blur}" />
          </StackPanel>
        </ToggleButton>

        <!-- Separator -->
        <Border Width="1" Background="#CCCCCC" Margin="4,0"/>

        <!-- Vertical Cut Out Tool Button -->
        <ToggleButton IsChecked="{Binding IsVerticalCutOutToolSelected}"
                      Command="{Binding SelectVerticalCutOutToolCommand}"
                      ToolTip.Tip="{local:Localize Tooltip_CutVertical}">
          <StackPanel HorizontalAlignment="Center">
            <Path Data="M2,10 L18,10 M10,8 L10,12"
                  Stroke="#FF6B6B"
                  StrokeThickness="2"
                  Fill="Transparent" />
            <TextBlock Text="{local:Localize Tool_CutVertical}" />
          </StackPanel>
        </ToggleButton>

        <!-- Horizontal Cut Out Tool Button -->
        <ToggleButton IsChecked="{Binding IsHorizontalCutOutToolSelected}"
                      Command="{Binding SelectHorizontalCutOutToolCommand}"
                      ToolTip.Tip="{local:Localize Tooltip_CutHorizontal}">
          <StackPanel HorizontalAlignment="Center">
            <Path Data="M10,2 L10,18 M8,10 L12,10"
                  Stroke="#FF6B6B"
                  StrokeThickness="2"
                  Fill="Transparent" />
            <TextBlock Text="{local:Localize Tool_CutHorizontal}" />
          </StackPanel>
        </ToggleButton>

      </StackPanel>
    </Border>

	  <views:UpdateCheckExpanderView DockPanel.Dock="Top" />

	  <!-- Main Content Area -->
    <Grid>
      <Grid.RowDefinitions>
        <RowDefinition Height="*"/>
        <RowDefinition Height="Auto"/>
      </Grid.RowDefinitions>

      <!-- Image Editor Canvas -->
      <ScrollViewer Grid.Row="0"
                    HorizontalScrollBarVisibility="Auto"
                    VerticalScrollBarVisibility="Auto"
                    Background="Black">
        <Grid>
          <controls:ImageEditorCanvas x:Name="EditorCanvas"
                                      Image="{Binding Image}"
                                      CurrentTool="{Binding CurrentTool, Mode=TwoWay}"
                                      Shapes="{Binding Shapes}"/>
          <Canvas x:Name="OverlayCanvas" />
        </Grid>
      </ScrollViewer>

      <!-- File Browser Panel -->
      <Border Grid.Row="1"
              BorderBrush="Black"
              BorderThickness="0,1,0,0"
              Background="#F8F8F8">
        <DockPanel>
          <!-- File Browser Header -->
          <Border DockPanel.Dock="Top"
                  Background="#1C1C1C"
                  BorderBrush="Black"
                  Padding="8"
                  BorderThickness="0,0,0,1">
            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
              </Grid.ColumnDefinitions>

              <Button Grid.Column="0"
                      Command="{Binding ToggleFileBrowserCommand}"
                      ToolTip.Tip="{local:Localize Tooltip_CollapseExpandPanel}"
                      Padding="4"
                      Margin="0,0,8,0"
                      Background="Transparent">
                <Path Data="{Binding IsFileBrowserVisible, Converter={StaticResource BoolToChevronPathConverter}}"
                      Fill="#D8DEE3"
                      Stretch="Uniform"
                      Width="16" Height="16"/>
              </Button>

              <TextBlock Grid.Column="1"
                         Text="{local:Localize Panel_Projects}"
                         FontWeight="Bold"
                         Foreground="White"
                         VerticalAlignment="Center"/>

              <Button Grid.Column="2"
                      Command="{Binding RefreshProjectFilesCommand}"
                      ToolTip.Tip="{local:Localize Tooltip_Refresh}"
                      Padding="4"
                      Background="Transparent">
                <Path Data="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"
                      Fill="#D8DEE3"
                      Stretch="Uniform"
                      Width="16" Height="16"/>
              </Button>
            </Grid>
          </Border>

          <!-- File List -->
          <ListBox DockPanel.Dock="Top"
                   ItemsSource="{Binding ProjectFiles}"
                   Background="#1C1C1C"
                   BorderBrush="#CCCCCC"
				   ScrollViewer.HorizontalScrollBarVisibility="Visible"
                   BorderThickness="0"
                   Height="160"
                   IsVisible="{Binding IsFileBrowserVisible}"
                   DoubleTapped="OnFileListDoubleTapped">
			  <ListBox.Styles>
				  <Style Selector="ScrollBar">
					  <Setter Property="AllowAutoHide" Value="False" />
				  </Style>  
			  </ListBox.Styles>
			  
			  <ListBox.ItemsPanel>
				  <ItemsPanelTemplate>
					  <StackPanel Orientation="Horizontal"/>
				  </ItemsPanelTemplate>
			  </ListBox.ItemsPanel>
            <ListBox.ItemTemplate>
              <DataTemplate>
					<Border BorderThickness="3"
					        CornerRadius="4"
					        Padding="4"
					        Margin="4 4 4 12">
						<Border.Styles>
							<Style Selector="Border">
								<Setter Property="BorderBrush" Value="Transparent"/>
								<Setter Property="Background" Value="Transparent"/>
							</Style>
							<Style Selector="Border[Tag=True]">
								<Setter Property="BorderBrush" Value="#FFA500"/>
								<Setter Property="Background" Value="#40FFA500"/>
							</Style>
						</Border.Styles>
						<Border.Tag>
							<Binding Path="IsCurrentFile"/>
						</Border.Tag>
						<Image Source="{Binding Thumbnail}"
							   MaxWidth="100"
							   MaxHeight="100"
							   ToolTip.Tip="{Binding ModifiedDate, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}"
							   HorizontalAlignment="Center"
							   Stretch="Uniform">
							<Image.ContextMenu>
								<ContextMenu>
									<MenuItem Header="{local:Localize ContextMenu_Open}" Command="{Binding $parent[ListBox].((vm:ImageEditorViewModel)DataContext).OpenProjectFileCommand}" CommandParameter="{Binding}"/>
									<MenuItem Header="{local:Localize ContextMenu_Delete}" Command="{Binding $parent[ListBox].((vm:ImageEditorViewModel)DataContext).DeleteProjectFileCommand}" CommandParameter="{Binding}"/>
								</ContextMenu>
							</Image.ContextMenu>
						</Image>
					</Border>
              </DataTemplate>
            </ListBox.ItemTemplate>
            <ListBox.Styles>
              <Style Selector="ListBoxItem">
                <Setter Property="Padding" Value="4"/>
                <Setter Property="Margin" Value="2"/>
              </Style>
              <Style Selector="ListBoxItem:pointerover">
                <Setter Property="Background" Value="#E8E8E8"/>
              </Style>
              <Style Selector="ListBoxItem:selected">
                <Setter Property="Background" Value="#D0D0D0"/>
              </Style>
            </ListBox.Styles>
          </ListBox>
        </DockPanel>
      </Border>
    </Grid>
  </DockPanel>
</UserControl>
