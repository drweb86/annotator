<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:ScreenshotAnnotator.ViewModels"
             xmlns:controls="using:ScreenshotAnnotator.Controls"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="ScreenshotAnnotator.Views.ImageEditorView"
             x:DataType="vm:ImageEditorViewModel">

  <Design.DataContext>
    <vm:ImageEditorViewModel />
  </Design.DataContext>

  <DockPanel>
	  <StackPanel Orientation="Horizontal" DockPanel.Dock="Top">
		  <!-- Menu Bar -->
		  <Menu>
			  <MenuItem x:Name="AboutMenuItem"
	              Header="{Binding HeaderInformation}">
				  <MenuItem.Items>
					  <MenuItem Header="Web-Site" Command="{Binding OpenWebsiteCommand}" />
					  <MenuItem Header="License" Command="{Binding OpenLicenseCommand}" />
				  </MenuItem.Items>
			  </MenuItem>

			  <MenuItem Header="_File">
				  <MenuItem Header="_New Project" Command="{Binding NewProjectCommand}" InputGesture="Ctrl+N"/>
				  <MenuItem Header="_Open Image..." Command="{Binding LoadImageCommand}" InputGesture="Ctrl+O"/>
				  <MenuItem Header="Open _Project..." Command="{Binding OpenProjectCommand}" InputGesture="Ctrl+Shift+O"/>
				  <Separator/>
				  <MenuItem Header="_Save Project" Command="{Binding SaveProjectCommand}" InputGesture="Ctrl+S"/>
				  <MenuItem Header="Save Project _As..." Command="{Binding SaveProjectAsCommand}" InputGesture="Ctrl+Shift+S"/>
				  <Separator/>
				  <MenuItem Header="Save As _Image..." Command="{Binding SaveAsImageCommand}" InputGesture="Ctrl+E"/>
				  <Separator/>
				  <MenuItem Header="Open Projects _Folder" Command="{Binding OpenProjectsFolderCommand}"/>
			  </MenuItem>
			  <MenuItem Header="_View">
				  <MenuItem Header="Toggle File _Browser" Command="{Binding ToggleFileBrowserCommand}" InputGesture="F9"/>
			  </MenuItem>
		  </Menu>
	  </StackPanel>
    

    <!-- Toolbar -->
    <Border DockPanel.Dock="Top"
            Background="#1C1C1C"
            BorderBrush="#CCCCCC"
            BorderThickness="0,0,0,1"
            Padding="8">
		<Border.Styles>
			<Style Selector="TextBlock">
				<Setter Property="Foreground" Value="#E6E6E6" />
				<Setter Property="FontSize" Value="12" />
				<Setter Property="HorizontalAlignment" Value="Center" />
			</Style>
			<Style Selector="Button">
				<Setter Property="Padding" Value="8" />
				<Setter Property="Background" Value="Transparent" />
			</Style>
			<Style Selector="ToggleButton">
				<Setter Property="Padding" Value="8" />
				<Setter Property="Background" Value="Transparent" />
			</Style>
			<Style Selector="Path">
				<Setter Property="Stretch" Value="Uniform" />
				<Setter Property="Width" Value="20" />
				<Setter Property="Height" Value="20" />
			</Style>
			<Style Selector="Ellipse">
				<Setter Property="Stretch" Value="Uniform" />
				<Setter Property="Width" Value="20" />
				<Setter Property="Height" Value="20" />
			</Style>
			<Style Selector="StackPanel">
				<Setter Property="Spacing" Value="8" />
			</Style>
		</Border.Styles>
      <StackPanel Orientation="Horizontal">

        <!-- Take Screenshot Button -->
        <Button Command="{Binding TakeScreenshotCommand}"
                ToolTip.Tip="Take Screenshot (F12)">
          <StackPanel HorizontalAlignment="Center">
            <Ellipse Fill="#F44336"
                     Stroke="#C62828"
                     StrokeThickness="2"/>
            <TextBlock Text="Screenshot" />
          </StackPanel>
        </Button>

        <!-- Separator -->
        <Border Width="1" Background="#CCCCCC" Margin="4,0"/>

		  <!-- Copy to Clipboard Button -->
		  <Button Command="{Binding CopyToClipboardCommand}"
				  ToolTip.Tip="Copy Result to Clipboard (Ctrl+C)">
			  <StackPanel HorizontalAlignment="Center">
				  <Path Data="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"
						Fill="#1976D2" />
				  <TextBlock Text="Copy" />
			  </StackPanel>
		  </Button>
		  
        <!-- Paste from Clipboard Button -->
        <Button Command="{Binding PasteFromClipboardCommand}"
                ToolTip.Tip="Paste Image from Clipboard (Ctrl+V)">
          <StackPanel HorizontalAlignment="Center">
            <Path Data="M19,20H5V4H7V7H17V4H19M12,2A1,1 0 0,1 13,3A1,1 0 0,1 12,4A1,1 0 0,1 11,3A1,1 0 0,1 12,2M19,2H14.82C14.4,0.84 13.3,0 12,0C10.7,0 9.6,0.84 9.18,2H5A2,2 0 0,0 3,4V20A2,2 0 0,0 5,22H19A2,2 0 0,0 21,20V4A2,2 0 0,0 19,2Z"
                  Fill="#1976D2" />
            <TextBlock Text="Paste" />
          </StackPanel>
        </Button>

        <!-- Separator -->
        <Border Width="1" Background="#CCCCCC" Margin="4,0"/>

        <!-- Select/Move Tool Button -->
        <ToggleButton IsChecked="{Binding IsSelectToolSelected}"
                      Command="{Binding SelectSelectToolCommand}"
                      ToolTip.Tip="Select and Move Tool (Click and drag shapes to move them)">
          <StackPanel HorizontalAlignment="Center">
            <Path Data="M2,2 L2,18 L7,13 L10,20 L13,19 L10,12 L18,12 Z"
                  Fill="#333333" />
            <TextBlock Text="Select" />
          </StackPanel>
        </ToggleButton>

        <!-- Arrow Tool Button -->
        <ToggleButton IsChecked="{Binding IsArrowToolSelected}"
                      Command="{Binding SelectArrowToolCommand}"
                      ToolTip.Tip="Arrow Tool">
          <StackPanel HorizontalAlignment="Center">
            <Path Data="M2,2 L18,10 L10,12 L8,20 Z M10,12 L18,18"
                  Stroke="#333333"
                  StrokeThickness="2"
                  Fill="Transparent" />
            <TextBlock Text="Arrow" />
          </StackPanel>
        </ToggleButton>

        <!-- Callout Tool Button -->
        <ToggleButton IsChecked="{Binding IsCalloutToolSelected}"
                      Command="{Binding SelectCalloutToolCommand}"
                      ToolTip.Tip="Callout Tool">
          <StackPanel HorizontalAlignment="Center">
            <Path Data="M4,4 L16,4 L16,12 L10,12 L8,16 L8,12 L4,12 Z"
                  Stroke="#333333"
                  StrokeThickness="2"
                  Fill="Transparent" />
            <TextBlock Text="Callout" />
          </StackPanel>
        </ToggleButton>

        <!-- Trim/Crop Tool Button -->
        <ToggleButton IsChecked="{Binding IsTrimToolSelected}"
                      Command="{Binding SelectTrimToolCommand}"
                      ToolTip.Tip="Trim/Crop Tool">
          <StackPanel HorizontalAlignment="Center">
            <Path Data="M7,3 L7,7 L3,7 M17,17 L17,13 L21,13 M7,7 L17,7 L17,17 L7,17"
                  Stroke="#333333"
                  StrokeThickness="2"
                  Fill="Transparent" />
            <TextBlock Text="Trim" />
          </StackPanel>
        </ToggleButton>

        <!-- Separator -->
        <Border Width="1" Background="#CCCCCC" Margin="4,0"/>

        <!-- Apply Trim Button -->
        <Button Command="{Binding ApplyTrimCommand}"
                ToolTip.Tip="Apply Trim"
                IsEnabled="{Binding IsTrimToolSelected}">
          <StackPanel HorizontalAlignment="Center">
            <Path Data="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"
                  Fill="#2E7D32" />
            <TextBlock Text="Apply" />
          </StackPanel>
        </Button>
      </StackPanel>
    </Border>

    <!-- Main Content Area -->
    <Grid>
      <Grid.RowDefinitions>
        <RowDefinition Height="*"/>
        <RowDefinition Height="Auto"/>
      </Grid.RowDefinitions>

      <!-- Image Editor Canvas -->
      <ScrollViewer Grid.Row="0"
                    HorizontalScrollBarVisibility="Auto"
                    VerticalScrollBarVisibility="Auto"
                    Background="White">
        <Grid>
          <controls:ImageEditorCanvas x:Name="EditorCanvas"
                                      Image="{Binding Image}"
                                      CurrentTool="{Binding CurrentTool, Mode=TwoWay}"
                                      Shapes="{Binding Shapes}"/>
          <Canvas x:Name="OverlayCanvas" />
        </Grid>
      </ScrollViewer>

      <!-- File Browser Panel -->
      <Border Grid.Row="1"
              Height="200"
              BorderBrush="Black"
              BorderThickness="0,1,0,0"
              Background="#F8F8F8"
              IsVisible="{Binding IsFileBrowserVisible}">
        <DockPanel>
          <!-- File Browser Header -->
          <Border DockPanel.Dock="Top"
                  Background="#1C1C1C"
                  BorderBrush="Black"
                  Padding="8"
                  BorderThickness="0,0,0,1">
            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
              </Grid.ColumnDefinitions>

              <TextBlock Grid.Column="0"
                         Text="Projects"
                         FontWeight="Bold"
                         VerticalAlignment="Center"/>

              <Button Grid.Column="1"
                      Command="{Binding RefreshProjectFilesCommand}"
                      ToolTip.Tip="Refresh"
                      Padding="4"
                      Background="Transparent">
                <Path Data="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"
                      Fill="#333333"
                      Stretch="Uniform"
                      Width="16" Height="16"/>
              </Button>
            </Grid>
          </Border>

          <!-- File List -->
          <ListBox DockPanel.Dock="Top"
                   ItemsSource="{Binding ProjectFiles}"
                   Background="#1C1C1C"
                   BorderBrush="#CCCCCC"
				   ScrollViewer.HorizontalScrollBarVisibility="Visible"
                   BorderThickness="0"
                   DoubleTapped="OnFileListDoubleTapped">
			  <ListBox.Styles>
				  <Style Selector="ScrollBar">
					  <Setter Property="AllowAutoHide" Value="False" />
				  </Style>  
			  </ListBox.Styles>
			  
			  <ListBox.ItemsPanel>
				  <ItemsPanelTemplate>
					  <StackPanel Orientation="Horizontal"/>
				  </ItemsPanelTemplate>
			  </ListBox.ItemsPanel>
            <ListBox.ItemTemplate>
              <DataTemplate>
					<Image Source="{Binding Thumbnail}"
						   MaxWidth="100"
						   MaxHeight="100"
						   ToolTip.Tip="{Binding ModifiedDate, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}"
						   Margin="8"
						   HorizontalAlignment="Center"
						   Stretch="Uniform">
						<Image.ContextMenu>
							<ContextMenu>
								<MenuItem Header="Open" Command="{Binding $parent[ListBox].((vm:ImageEditorViewModel)DataContext).OpenProjectFileCommand}" CommandParameter="{Binding}"/>
								<MenuItem Header="Delete" Command="{Binding $parent[ListBox].((vm:ImageEditorViewModel)DataContext).DeleteProjectFileCommand}" CommandParameter="{Binding}"/>
							</ContextMenu>
						</Image.ContextMenu>
				</Image>
              </DataTemplate>
            </ListBox.ItemTemplate>
            <ListBox.Styles>
              <Style Selector="ListBoxItem">
                <Setter Property="Padding" Value="4"/>
                <Setter Property="Margin" Value="2"/>
              </Style>
              <Style Selector="ListBoxItem:pointerover">
                <Setter Property="Background" Value="#E8E8E8"/>
              </Style>
              <Style Selector="ListBoxItem:selected">
                <Setter Property="Background" Value="#D0D0D0"/>
              </Style>
            </ListBox.Styles>
          </ListBox>
        </DockPanel>
      </Border>
    </Grid>
  </DockPanel>
</UserControl>
